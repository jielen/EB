<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>用户认证系统 登录界面 </title>
<script type="text/javascript" src="/includes/crypt.js"></script>
<script type="text/javascript" src="/includes/niftycube.js"></script>
<link href="/language/chs/css/fonts.css" rel="stylesheet" type="text/css">
<script>
/* Create a new XMLHttpRequest object to talk to the Web server */
var xmlHttp = false;


if (!xmlHttp && typeof XMLHttpRequest != 'undefined')
{
  	xmlHttp = new XMLHttpRequest();
}

function callServerPost(type)
{
		var url = "exchange=16";
	
		// Open a connection to the server
		xmlHttp.open("POST", "/", true);
		xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
	
		// Send the request
		xmlHttp.send(url);
	
		// Setup a function for the server to run when it's done
		if (type == 'login')
		{
			  xmlHttp.onreadystatechange = loginPage;
		}
		else if (type == 'changepass')
		{
			  xmlHttp.onreadystatechange = updatePage;
		}
}

function loginPage()
{
		var form = document.loginForm;
		if(form.password_type.value=='enc')
		{
				if(form.password.value!=form.password_orig.value)
				{
						form.password_type.value='normal';
				}
		}
		if(form.password_type.value=='enc')
		{
				document.getElementById('password_enc').value=form.password.value;
		}
		else
		{
				document.getElementById('password_enc').value=encode64(encodeURIComponent(document.getElementById('password').value));
		}
		document.getElementById('loginForm').submit();
}


function updatePage()
{
		var form = document.loginForm;
		if(form.password_type.value=='enc')
		{
				if(form.password.value!=form.password_orig.value)
				{
						form.password_type.value='normal';
				}
		}
		if(form.password_type.value=='enc')
		{
				document.getElementById('password_enc').value=form.password.value;
		}
		else
		{
				document.getElementById('password_enc').value=encode64(encodeURIComponent(document.getElementById('password').value));
		}
		document.getElementById('newpassword_enc').value = encode64(encodeURIComponent(document.getElementById('new_password').value));
		document.getElementById('retype_newpassword_enc').value = encode64(encodeURIComponent(document.getElementById('retype_newpassword').value));
		document.getElementById('loginForm').submit();
}

//获得Cookie解码后的值
function GetCookieVal(offset)
{
		var endstr = document.cookie.indexOf (";", offset);
		if (endstr == -1)
		endstr = document.cookie.length;
		return unescape(document.cookie.substring(offset, endstr));
}
//设定Cookie值
function SetCookie(name, value)
{
		var expdate = new Date();
		var argv = SetCookie.arguments;
		var argc = SetCookie.arguments.length;
		var expires = 30;
		var path = (argc > 3) ? argv[3] : null;
		var domain = (argc > 4) ? argv[4] : null;
		var secure = (argc > 5) ? argv[5] : false;
		if(expires!=null) expdate.setTime(expdate.getTime() + ( expires*24*3600*1000));
		document.cookie = name + "=" + escape (value) +((expires == null) ? "" : ("; expires="+ expdate.toGMTString()))
		+((path == null) ? "" : ("; path=" + path)) +((domain == null) ? "" : ("; domain=" + domain))
		+((secure == true) ? "; secure" : "");
}
//删除Cookie
function DelCookie(name)
{
		var exp = new Date();
		exp.setTime (exp.getTime() - 1);
		var cval = GetCookie (name);
		document.cookie = name + "=" + cval + "; expires="+ exp.toGMTString();
}
//获得Cookie的原始值
function GetCookie(name)
{
		var arg = name + "=";
		var alen = arg.length;
		var clen = document.cookie.length;
		var i = 0;
		while (i < clen)
		{
		var j = i + alen;
		if (document.cookie.substring(i, j) == arg)
		return GetCookieVal (j);
		i = document.cookie.indexOf(" ", i) + 1;
		if (i == 0) break;
		}
		return null;
}
</script>
<script language="javascript" type="text/javascript">
function setFocus() 
{
		document.loginForm.username.select();
		document.loginForm.username.focus();
}

function testcomplex(passwd) {
	try{
		if(passwd.length<8)
			return 1;
		//是否同时存在数字，大小写字符，特殊字母，并且第一个字符为数字或字母
		var ls = 0;   
		if(passwd.match(/([a-z])+/)){   
			ls++; 
		}   
		if(passwd.match(/([0-9])+/)){   
			ls++;     
		}   
		if(passwd.match(/([A-Z])+/)){   
			ls++;   
		}   
		if(passwd.match(/[^a-zA-Z0-9]+/)){   
			ls++;   
		} 
		if (ls < 4) {
			return 1;
		} 
	}catch(err){
		return 1;
	}
	return 0;
}

function submitbutton(type) 
{
		var form = document.loginForm;
		if(!isNotEmpty(form.username.value))
		{
				alert("请输入用户名！");
				return false;
		}
		if(!isNotEmpty(form.password.value))
		{
				alert("请输入密码！");
				return false;
		}
		if(type=='login')
		{
				form.login_type.value='login';
				
				var save_user = document.getElementById('save_user').checked;
				var save_pass = document.getElementById('save_pass').checked;
				var username = document.getElementById('username').value;
				var password = document.getElementById('password').value;
				if(save_user == true && save_pass == true)
				{
						SetCookie('username', username);
						SetCookie('password', password);
						SetCookie('save_user', save_user);
						SetCookie('save_pass', save_pass);
				}
				else if(save_user == true)
				{
						SetCookie('username', username);
						SetCookie('save_user', save_user);
						DelCookie('password');
						DelCookie('save_pass');
				}else
				{
						DelCookie('username');
						DelCookie('password');
						DelCookie('save_user');
						DelCookie('save_pass');
				}
				
				loginPage();
				return false;
		}
		if(type=='changepass')
		{
				if(!isNotEmpty(form.new_password.value))
				{
						alert("请输入新密码！");
						return false;
				}
				if(!isNotEmpty(form.retype_newpassword.value))
				{
						alert("请输入确认密码！");
						return false;
				}
				if(form.new_password.value!=form.retype_newpassword.value)
				{
						alert("新密码与确认密码不符，请重新输入！");
						return false;
				}
				    	
				form.login_type.value='changepass';
				updatePage();
				return false;
		}
}
function isNotEmpty(s)
{
		var whitespace = " \t\n\r";
		var i;
		if((s == null) || (s.length == 0))
		{      
				return false;
		}
		for (i = 0; i << s.length; i++)    
		{   
				var c = s.charAt(i);
				if (whitespace.indexOf(c) == -1) 
				{
						return false;
				}
		}
		return true;
}
</script>
<style type="text/css">
<!--
.bg01 {
	background:#8f98a1;
}
.style01{
	border-left:1px;border-right:1px;
}
.style02{
	border-left:6px;border-right:6px;
}
.style03{
	height:22px;
}
.style04{
	width:65px;padding-right:11px;text-align:right;
}
.style05{
	width:123px;border:1px solid #90aac5;height:20px;
}
.style06{
	padding:6px 4px 5px 4px;
}
.style07{
	width:107px;padding-right:11px;text-align:right;
}
.close {display:block;position:absolute;right:20px;top:8px;font:10px Verdana;cursor:pointer;}
ul#split,ul#split li{margin:0;padding:0;list-style:none}

ul#split li{float:left;margin:0 10px 10px 0;width:160}ul#split h3{font: normal 130%/1.3 STXinwei,Microsoft YaHei,SimSun;
	margin:0px;padding: 5px 0 3px;text-align:center;color:#000}
ul#split p{margin:0;padding:5px 8px 15px;}
ul#split div{background:#d6ebff}
li#one h3{background: #9CC0FF; border-bottom: 1px white solid;}
p{word-wrap : break-word;}
b.niftycorners,b.niftyfill{display:block}
b.niftycorners *{display:block;height: 1px;line-height:1px;font-size: 1px;
    overflow:hidden;border-style:solid;border-width: 0 1px}
b.r1{margin: 0 3px;border-width: 0 2px}
b.r2{margin: 0 2px}
b.r3{margin: 0 1px}
b.r4{height: 2px}
b.rb1{margin: 0 8px;border-width:0 2px}
b.rb2{margin: 0 6px;border-width:0 2px}
b.rb3{margin: 0 5px}
b.rb4{margin: 0 4px}
b.rb5{margin: 0 3px}
b.rb6{margin: 0 2px}
b.rb7{margin: 0 1px;height:2px}
b.rb8{margin: 0;height:2px}
b.rs1{margin: 0 1px}
b.t1{border-width: 0 5px}
b.t2{border-width: 0 3px}
b.t3{border-width: 0 2px}
b.t4{height: 2px}
b.tb1{border-width: 0 10px}
b.tb2{border-width: 0 8px}
b.tb3{border-width: 0 6px}
b.tb4{border-width: 0 5px}
b.tb5{border-width: 0 4px}
b.tb6{border-width: 0 3px}
b.tb7{border-width: 0 2px;height:2px}
b.tb8{border-width: 0 1px;height:2px}
b.ts1{border-width: 0 2px}
.checkbox01{
	position: relative;
	left: -6px;
	top: -6px;
	color: #061d63;
	border-style: none;
	border-width: 0px;
	background-color: #ffffff;
}
.checkbox_div01{
    border: 1px solid #69819d;
    width:  11px;
    height: 11px;
    overflow: hidden;
}
-->
</style>
</head>

<body onLoad="setFocus();" class=bg01 onKeyDown="if(event.keyCode==13)submitbutton('login')">
<form action="/" method="post" name="loginForm" id="loginForm">
<table width="368" align=center cellpadding="0" cellspacing="0" height=244 background="/includes/bg.gif">
  <tr>
    <td height="68" style="padding-left:10px;" valign=top><img src=/includes/logo.gif border=0 width="140" height="55"></td>
  </tr>
  <tr>
    <td class=style01 valign=top>
		<table width="100%" cellpadding="0" cellspacing="0" class=style02>
		 	<tr>
	 		   <td align=center>
			   		<table width="318" cellspacing="0" cellpadding="0">
	              <tr>
	                <td rowspan="4" width="42" height=64>&nbsp;</td>
	                <td colspan=3 style="height:2"></td>
	              </tr>
	              <tr class="style03">
	                <td class="style04">用户名</td>
			          	<td width=128><input type="text" name="username" maxlength=50 id="username" class=style05 value=''></td>
	                <td>&nbsp;</td>
	              </tr>
	              <tr class="style03">
	                <td class="style04">密　码</td>
			         		<td><input type="password" name="password" maxlength=32 id="password" class=style05 value=''></td>
	                <td><a href=# onclick="submitbutton('login');"><img src="/language/chs/images/weblogin/login.gif"  height="21" border=0></a></td>
	              </tr>
	              <tr>
	                <td style="height:2" colspan=3></td>
	              </tr>
	          </table>
			  		<table width="100%" cellspacing="0" cellpadding="0">
	          		<tr>
	              		<td align=right style="padding-bottom:3px;">
											  <table cellspacing="0" cellpadding="0">
													<tr height=21>
													  <td width=20><div class=checkbox_div01><input type=checkbox id="save_user" name="save_user" value=1 class=checkbox01 onclick="if(this.checked==false)form.save_pass.checked=false"></div></td>
													  <td width=100 style="padding-top:4px">保存用户名</td>
													  <td width=20><div class=checkbox_div01><input type=checkbox id="save_pass" name="save_pass" value=1 class=checkbox01 onclick="if(this.checked==true)form.save_user.checked=true"></div></td>
													  <td width=100 style="padding-top:4px">记住密码</td>
													</tr>
											  </table>
										</td>
	              </tr>
	          </table>
	          				 </td>
			</tr>
		  <tr>
		    <td height="12"></td>
		  </tr>
		<input type=hidden id="url" name="url" value=''>
		<input type=hidden id="password_enc" name="password_enc" value=''>
		<input type=hidden id="newpassword_enc" name="newpassword_enc" value=''>
		<input type=hidden id="retype_newpassword_enc" name="retype_newpassword_enc" value=''>
		<input type=hidden id="login" name="login" value="1">  
		<input type=hidden id="login_type" name="login_type" value=''>  
		<input type=hidden id="uri" name=uri value='aHR0cDovLzE5Mi4xNjguNjAuNjUv'>  
		<input type=hidden id="password_type" name="password_type" value='normal'>  
		<input type=hidden id="password_orig" name="password_orig" value=''>  
		</table>
				<span id="key" style="display:none;"></span>
		</td>
	</tr>
</table>
</form>
<script>
function chgSize(h){
	document.getElementById('content').style.height = h;
}
window.onload=function(){
	var height = document.getElementById('content').clientHeight;
	chgSize(height+10);
	Nifty("ul#split h3","tr");
	Nifty("ul#split div","br same-height");
}
</script>

    <script>
		user_name = GetCookie('username');
		pass_word = GetCookie('password');
		save_user_name = GetCookie('save_user');
		save_pass_word = GetCookie('save_pass');
		if(user_name == null)
		{
				user_name = '';
		}
		
		if(pass_word == null)
		{
				pass_word = '';
		}
		document.getElementById('username').value = user_name;
		document.getElementById('password').value = pass_word;
		document.getElementById('save_user').checked= save_user_name;
		document.getElementById('save_pass').checked = save_pass_word;
</script>
</body>
</html>